### ubuntu 安装nginx 并加上反向代理配置
```
sudo vim /etc/nginx/sites-available/myap.conf
```

```text
server {
    listen 80;
    server_name ydphoto.com;

    location / {
        proxy_pass http://100.115.212.87:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

```shell
sudo ln -s /etc/nginx/sites-available/myapp.conf /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/gitlab.conf /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 证书创建

```shell
# 1. 下载并安装 acme.sh
curl https://get.acme.sh | sh -s email=jchengyu0829@163.com

# 2. 让 acme.sh 命令在当前终端生效
source ~/.bashrc

# 3. 或者创建一个软链接到可执行路径（更推荐）
ln -s  ~/.acme.sh/acme.sh /usr/local/bin/acme.sh
```

#### 将你的密钥导入环境变量  

export Ali_Key=""
export Ali_Secret="你的AccessKey Secret"

```shell
acme.sh --issue --dns dns_ali -d ydphoto.com -d *.ydphoto.com
```

```shell
# 创建证书存放目录
mkdir -p /etc/ssl/ydphoto.com/

# 将申请好的证书安装/复制到指定位置
# 以通配符证书为例：
acme.sh --install-cert -d ydphoto.com \
--key-file       /etc/ssl/ydphoto.com/privkey.pem  \
--fullchain-file /etc/ssl/ydphoto.com/fullchain.pem \
--reloadcmd     "systemctl reload nginx" # 可选：证书自动续期后重载Nginx

# 如果申请的是单域名证书，例如 derp.ydphoto.com
acme.sh --install-cert -d derp.ydphoto.com \
--key-file       /etc/ssl/derp.ydphoto.com/privkey.pem  \
--fullchain-file /etc/ssl/derp.ydphoto.com/fullchain.pem \
--reloadcmd     "systemctl reload nginx"
```

```shell
# 一个server块处理所有匹配 *.ydphoto.com 的请求
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name ~^(.+)\.ydphoto\.com$; # 使用正则匹配所有子域名

    # 使用通配符证书，一劳永逸
    ssl_certificate /etc/ssl/ydphoto.com/fullchain.pem;
    ssl_certificate_key /etc/ssl/ydphoto.com/privkey.pem;

    # 根据不同的子域名，代理到不同的后端服务
    location / {
        if ($host = "derp.ydphoto.com") {
            proxy_pass https://100.115.212.87:8289;
        }
        if ($host = "www.ydphoto.com") {
            proxy_pass http://100.115.212.87:80;
        }
    }
}
```

windows 的公钥
```text
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMCo3ODRpmN/HvSQl+vhRHYAs1fCwOycwlgUd6OPTa8Y jchengyu998@163.com
```

pipeline

```groovy
@Library('my-jenkins-pipeline-shared@master') _

deploy_api([
    gitUrl: 'https://github.com/jiangchengyu998/photo-show.git',
    apiPort: '3000',
    branch: 'main'
])

```

# 设置WSL2端口转发
直接执行 ./wsl2-ssh.ps1

